<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Arcade Intermission Stats</title>
  <style>
    html, body { margin:0; padding:0; width:1920px; height:1080px; background:transparent; overflow:hidden; font-family: Arial, sans-serif; }
    #root { position:relative; width:1920px; height:1080px; }
    .panel { position:absolute; top: 140px; left:50%; transform:translateX(-50%); width:1600px; height:800px; background:rgba(10, 16, 28, 0.8); border:1px solid rgba(255,255,255,0.1); border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); color:#e5e7eb; padding: 20px 28px; }
    .title { font-size:40px; font-weight:800; letter-spacing:2px; text-align:center; margin-bottom:12px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 16px; height: 680px; }
    .stat { background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); border-radius: 10px; padding: 16px; }
    .stat h3 { margin:0 0 10px 0; font-size:20px; color:#cbd5e1; }
    .bar { height: 18px; background: rgba(255,255,255,0.08); border-radius: 9px; position:relative; overflow:hidden; }
    .bar > div { height:100%; transition: width 300ms ease; }
    .bar .blue { background: linear-gradient(90deg, #1e40af, #3b82f6); }
    .bar .red { background: linear-gradient(90deg, #7f1d1d, #ef4444); }
    .row { display:flex; align-items:center; justify-content:space-between; margin: 8px 0; }
  </style>
</head>
<body>
  <div id="root">
    <div class="panel">
      <div class="title">INTERMISSION STATS</div>
      <div class="grid">
        <div class="stat">
          <h3>HEAD KICKS</h3>
          <div class="row"><span>Blue</span><span id="hkBlue">0</span></div>
          <div class="bar"><div class="blue" id="hkBlueBar" style="width:0%"></div></div>
          <div class="row"><span>Red</span><span id="hkRed">0</span></div>
          <div class="bar"><div class="red" id="hkRedBar" style="width:0%"></div></div>
        </div>
        <div class="stat">
          <h3>BODY KICKS</h3>
          <div class="row"><span>Blue</span><span id="bkBlue">0</span></div>
          <div class="bar"><div class="blue" id="bkBlueBar" style="width:0%"></div></div>
          <div class="row"><span>Red</span><span id="bkRed">0</span></div>
          <div class="bar"><div class="red" id="bkRedBar" style="width:0%"></div></div>
        </div>
        <div class="stat">
          <h3>WARNINGS</h3>
          <div class="row"><span>Blue</span><span id="wBlue">0</span></div>
          <div class="bar"><div class="blue" id="wBlueBar" style="width:0%"></div></div>
          <div class="row"><span>Red</span><span id="wRed">0</span></div>
          <div class="bar"><div class="red" id="wRedBar" style="width:0%"></div></div>
        </div>
        <div class="stat">
          <h3>HIT LEVEL AVG</h3>
          <div class="row"><span>Blue</span><span id="hlBlue">0</span></div>
          <div class="bar"><div class="blue" id="hlBlueBar" style="width:0%"></div></div>
          <div class="row"><span>Red</span><span id="hlRed">0</span></div>
          <div class="bar"><div class="red" id="hlRedBar" style="width:0%"></div></div>
        </div>
      </div>
    </div>
  </div>
  <script src="./shared.js"></script>
  <script>
    const { OverlayBus, mapEvent } = window.__ARCADE_OVERLAY__;
    const st = { hkB:0, hkR:0, bkB:0, bkR:0, wB:0, wR:0, hlB:0, hlR:0, nB:0, nR:0 };
    function set(id, v) { document.getElementById(id).textContent = v; }
    function bar(id, pct) { document.getElementById(id).style.width = `${Math.max(0, Math.min(100, pct))}%`; }
    function refresh() {
      set('hkBlue', st.hkB); set('hkRed', st.hkR);
      set('bkBlue', st.bkB); set('bkRed', st.bkR);
      set('wBlue', st.wB); set('wRed', st.wR);
      set('hlBlue', (st.nB? (st.hlB/st.nB).toFixed(0):0)); set('hlRed', (st.nR? (st.hlR/st.nR).toFixed(0):0));
      const hkTot = st.hkB + st.hkR || 1; bar('hkBlueBar', st.hkB/hkTot*100); bar('hkRedBar', st.hkR/hkTot*100);
      const bkTot = st.bkB + st.bkR || 1; bar('bkBlueBar', st.bkB/bkTot*100); bar('bkRedBar', st.bkR/bkTot*100);
      const wTot = st.wB + st.wR || 1; bar('wBlueBar', st.wB/wTot*100); bar('wRedBar', st.wR/wTot*100);
      const hlTot = (st.nB? st.hlB/st.nB:0) + (st.nR? st.hlR/st.nR:0) || 1; bar('hlBlueBar', ((st.nB? st.hlB/st.nB:0)/hlTot)*100); bar('hlRedBar', ((st.nR? st.hlR/st.nR:0)/hlTot)*100);
    }
    OverlayBus.subscribe((raw) => {
      const e = mapEvent(raw);
      if (e.kind === 'points') {
        // assume 3+ is head, 2 is body
        if (e.athlete === 1 || e.athlete === 'blue') { if (e.points >= 3) st.hkB++; else if (e.points === 2) st.bkB++; }
        else { if (e.points >= 3) st.hkR++; else if (e.points === 2) st.bkR++; }
        refresh();
      } else if (e.kind === 'warning') {
        if (e.athlete === 1 || e.athlete === 'blue') st.wB++; else st.wR++; refresh();
      } else if (e.kind === 'hit') {
        if (e.athlete === 1 || e.athlete === 'blue') { st.hlB += e.level||0; st.nB++; } else { st.hlR += e.level||0; st.nR++; }
        refresh();
      }
    });
  </script>
</body>
</html>


