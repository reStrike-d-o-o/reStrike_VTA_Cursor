<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Arcade Scoreboard Overlay</title>
  <style>
    html, body { margin: 0; padding: 0; width: 1920px; height: 1080px; overflow: hidden; background: transparent; font-family: Arial, sans-serif; }
    #root { position: relative; width: 1920px; height: 1080px; }
    .hud { position: absolute; top: 24px; left: 24px; right: 24px; height: 160px; display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; }
    .panel { height: 160px; display: flex; align-items: center; padding: 12px 18px; border-radius: 10px; box-shadow: 0 8px 24px rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.08); }
    .blue { background: linear-gradient(135deg, #0b3a8b, #2770ff); color: #e2e8f0; }
    .red { background: linear-gradient(135deg, #8b0b1a, #ff2740); color: #fee2e2; }
    .name { font-size: 38px; font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.5); letter-spacing: 1px; }
    .flag { width: 64px; height: 42px; object-fit: contain; margin-right: 12px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4)); }
    .score { font-size: 96px; font-weight: 900; padding: 0 22px; color: #fff; text-shadow: 0 6px 18px rgba(0,0,0,0.6), 0 0 12px rgba(255,255,255,0.2); }
    .timer { position: absolute; top: 200px; left: 50%; transform: translateX(-50%); font-size: 72px; font-weight: 900; color: #e5e7eb; text-shadow: 0 4px 12px rgba(0,0,0,0.6); letter-spacing: 4px; }
    .round { position: absolute; top: 290px; left: 50%; transform: translateX(-50%); font-size: 24px; color: #cbd5e1; }
    .effects { position: absolute; inset: 0; pointer-events: none; }
    .hit { position: absolute; width: 420px; height: 420px; border-radius: 50%; filter: blur(22px); mix-blend-mode: screen; opacity: 0; }
    .hit.blue { background: radial-gradient(circle, rgba(59,130,246,0.7), rgba(59,130,246,0.0)); left: 12%; top: 28%; }
    .hit.red { background: radial-gradient(circle, rgba(239,68,68,0.7), rgba(239,68,68,0.0)); right: 12%; top: 28%; }
    .hit.show { animation: hitPulse 420ms ease-out forwards; }
    @keyframes hitPulse { 0% { transform: scale(0.8); opacity: 0.0; } 50% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.3); opacity: 0; } }
    .top-banner { position: absolute; top: 0; left: 0; right: 0; height: 8px; background: linear-gradient(90deg, rgba(59,130,246,0.0), rgba(59,130,246,0.6), rgba(59,130,246,0.0)); opacity: 0; }
    .top-banner.red { background: linear-gradient(90deg, rgba(239,68,68,0.0), rgba(239,68,68,0.6), rgba(239,68,68,0.0)); }
    .top-banner.show { animation: banner 600ms ease-out forwards; }
    @keyframes banner { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }
  </style>
</head>
<body>
  <div id="root">
    <div class="hud">
      <div class="panel blue">
        <img id="flagBlue" class="flag" alt="" />
        <div class="name" id="nameBlue">BLUE</div>
      </div>
      <div class="score" id="score">0 - 0</div>
      <div class="panel red" style="justify-content:flex-end">
        <div class="name" id="nameRed">RED</div>
        <img id="flagRed" class="flag" alt="" />
      </div>
    </div>
    <div class="timer" id="timer">03:00</div>
    <div class="round" id="round">ROUND 1</div>
    <div class="effects">
      <div class="top-banner" id="bannerBlue"></div>
      <div class="top-banner red" id="bannerRed"></div>
      <div class="hit blue" id="hitBlue"></div>
      <div class="hit red" id="hitRed"></div>
    </div>
  </div>
  <script src="./shared.js"></script>
  <script>
    const { OverlayBus, mapEvent } = window.__ARCADE_OVERLAY__;
    const el = {
      nameBlue: document.getElementById('nameBlue'),
      nameRed: document.getElementById('nameRed'),
      flagBlue: document.getElementById('flagBlue'),
      flagRed: document.getElementById('flagRed'),
      score: document.getElementById('score'),
      timer: document.getElementById('timer'),
      round: document.getElementById('round'),
      hitBlue: document.getElementById('hitBlue'),
      hitRed: document.getElementById('hitRed'),
      bannerBlue: document.getElementById('bannerBlue'),
      bannerRed: document.getElementById('bannerRed'),
    };
    let scores = { blue: 0, red: 0 };
    let athletes = { blue: { long: 'BLUE' }, red: { long: 'RED' } };
    function setFlag(img, code) {
      if (!code) return;
      img.src = `../../assets/flags/svg/${code.toUpperCase()}.svg`;
    }
    function updateNames() {
      el.nameBlue.textContent = (athletes.blue.long || athletes.blue.short || 'BLUE').toUpperCase();
      el.nameRed.textContent = (athletes.red.long || athletes.red.short || 'RED').toUpperCase();
    }
    function updateScores() {
      el.score.textContent = `${scores.blue} - ${scores.red}`;
      el.score.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.08)' }, { transform: 'scale(1)' }], { duration: 260, easing: 'ease-out' });
    }
    function pulse(elm) {
      elm.classList.remove('show');
      void elm.offsetWidth; // reflow
      elm.classList.add('show');
    }
    OverlayBus.subscribe((raw) => {
      const e = mapEvent(raw);
      switch (e.kind) {
        case 'athletes':
          athletes = { blue: e.blue || athletes.blue, red: e.red || athletes.red };
          updateNames();
          setFlag(el.flagBlue, e.blue?.country || e.blue?.iocCode);
          setFlag(el.flagRed, e.red?.country || e.red?.iocCode);
          break;
        case 'scores':
          scores = { blue: e.blue, red: e.red }; updateScores(); break;
        case 'clock':
          el.timer.textContent = e.time || '00:00'; el.round.textContent = `ROUND ${e.round || 1}`; break;
        case 'points':
          if (e.athlete === 'athlete1' || e.athlete === 1 || e.athlete === 'blue') { scores.blue += e.points || 1; updateScores(); pulse(el.bannerBlue); pulse(el.hitBlue); }
          else { scores.red += e.points || 1; updateScores(); pulse(el.bannerRed); pulse(el.hitRed); }
          break;
        case 'hit':
          if (e.athlete === 1 || e.athlete === 'blue') pulse(el.hitBlue); else pulse(el.hitRed); break;
        case 'warning':
          // Could add a warning banner here
          break;
        case 'winner':
          // future: trigger winner animation
          break;
      }
    });
  </script>
</body>
</html>


