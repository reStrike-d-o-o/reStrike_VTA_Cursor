import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';

type Catalog = Record<string, string>;
interface Catalogs { [locale: string]: Catalog }

interface I18nContextValue {
  locale: string;
  setLocale: (locale: string) => void;
  t: (id: string, fallback?: string, values?: Record<string, string | number>) => string;
}

const I18N_STORAGE_KEY = 'app.locale';
const I18nContext = createContext<I18nContextValue | undefined>(undefined);

const catalogs: Catalogs = {
  en: {
    'drawer.pss': 'PSS',
    'drawer.obs': 'OBS',
    'drawer.ovr': 'OVR',
    'drawer.ivr': 'IVR',
    'drawer.ai': 'AI',
    'drawer.settings': 'Settings',
    'app.title': 'reStrike VTA - Windows Desktop',
    'env.windows_native': 'Windows Native',
    'env.web_mode': 'Web Mode',
    'status.ready': 'Status: Ready',
    'action.generic': 'Action',
    'common.retry': 'Retry',
    'common.unknown_error': 'Unknown error',
    // Tabs
    'settings.tabs.diagnostics': 'Diagnostics & Logs Manager',
    'settings.tabs.database': 'Database',
    'settings.tabs.backup': 'Backup & Restore',
    'settings.tabs.app': 'App Settings',
    'ivr.tabs.history': 'Match History',
    'ivr.tabs.settings': 'IVR Video Settings',
    'ovr.tabs.integration': 'Integration',
    'ovr.tabs.tournament': 'Tournament Management',
    'obs.tabs.websocket': 'WebSocket',
    'obs.tabs.control_room': 'Control Room',
    'obs.tabs.integration': 'Integration',
    'pss.tabs.udp': 'UDP Server & Protocol',
    'pss.tabs.flags': 'Flag Management',
    'pss.tabs.scoreboard': 'Scoreboard',
    'pss.tabs.simulation': 'Simulation',
    'pss.tabs.triggers': 'Triggers',
    // Settings content
    'settings.language': 'Language',
    'settings.select_language': 'Select language',
    'settings.window.title': 'Window Settings',
    'settings.window.help': 'Configure the window dimensions for compact and fullscreen modes.',
    'settings.window.compact': 'Compact Mode (Default)',
    'settings.window.full': 'Fullscreen Mode (Advanced)',
    'settings.window.width': 'Width (px)',
    'settings.window.height': 'Height (px)',
    'settings.quick.title': 'Quick Presets',
    'settings.appearance.title': 'Appearance',
    'settings.appearance.theme': 'Theme',
    'settings.appearance.corners': 'Corners',
    'settings.appearance.dark': 'Dark',
    'settings.appearance.light': 'Light',
    'settings.appearance.square': 'Square',
    'settings.appearance.rounded': 'Rounded',
    'settings.log.title': 'Log verbosity',
    'settings.log.note': 'Lower levels reduce console noise in production.',
    'settings.actions.apply': 'Apply Settings',
    'settings.actions.reset': 'Reset',
    'settings.note.title': 'Note:',
    'settings.note.text': 'Compact mode is used when the app starts and when Advanced mode is disabled. Fullscreen mode is used when Advanced mode is enabled.',
    // Logs
    'logs.title': 'Download Logs',
    'logs.type': 'Type:',
    'logs.select_type': 'Select log type',
    'logs.types.pss': 'PSS',
    'logs.types.obs': 'OBS',
    'logs.types.udp': 'UDP',
    'logs.types.websocket': 'WebSocket',
    'logs.types.db': 'Database',
    'logs.types.app': 'Application',
    'logs.types.arc': 'Archive',
    'logs.table.file': 'File Name',
    'logs.table.size': 'Size',
    'logs.table.modified': 'Modified',
    'logs.loading': 'Loading logs...',
    'logs.downloading': 'Downloading...',
    'logs.archive': 'Archive',
    'logs.double_click': 'Double-click to download',
    'logs.none': 'No logs found',
    'logs.none_error': 'No logs found due to error',
    'logs.error.fetch_archives': 'Failed to fetch archive files',
    'logs.error.fetch_logs': 'Failed to fetch log files',
    'logs.error.timeout': 'Command timed out. The backend may be busy or unresponsive. Please try again.',
    'logs.error.tauri_missing': 'Tauri not available. Please ensure the app is running in desktop mode.',
    'logs.error.generic_fetch': 'Error fetching {what}: {msg}',
    'logs.error.download_timeout': 'Download timed out for {name}. Please try again.',
    'logs.error.download_failed': 'Failed to download {name}: {msg}',
    'logs.error.tauri_no_download': 'Tauri not available. Cannot download {name} in web mode.',
    'logs.error.download_error': 'Error downloading {name}: {msg}',
    // Archive manager & backup
    'logs.archive_mgr.title': 'Log Archive Manager',
    'logs.archive_mgr.load_failed': 'Failed to load configuration',
    'logs.archive_mgr.load_failed_with': 'Failed to load configuration: {err}',
    'logs.archive_mgr.save_ok': 'Configuration saved successfully',
    'logs.archive_mgr.save_failed': 'Failed to save configuration',
    'logs.archive_mgr.save_failed_with': 'Failed to save configuration: {err}',
    'logs.archive_mgr.create_ok': 'Archive created successfully: {name}',
    'logs.archive_mgr.create_failed': 'Failed to create archive',
    'logs.archive_mgr.create_failed_with': 'Failed to create archive: {err}',
    'logs.archive_mgr.upload_ok': 'Archive uploaded successfully',
    'logs.archive_mgr.upload_failed': 'Failed to upload archive',
    'logs.archive_mgr.upload_failed_with': 'Failed to upload archive: {err}',
    'logs.archive_mgr.upload_cleanup_ok': 'Archive uploaded and cleaned up successfully',
    'logs.archive_mgr.upload_cleanup_failed': 'Failed to upload and cleanup archive',
    'logs.archive_mgr.upload_cleanup_failed_with': 'Failed to upload and cleanup archive: {err}',
    'logs.archive_mgr.auto_ok': 'Auto-archive completed successfully',
    'logs.archive_mgr.auto_failed': 'Auto-archive failed',
    'logs.archive_mgr.auto_failed_with': 'Auto-archive failed: {err}',
    'logs.archive_mgr.create_title': 'Create local archive',
    'logs.archive_mgr.create_upload_title': 'Create and upload to Drive',
    'logs.archive_mgr.upload_delete_title': 'Upload and delete local copy',
    'logs.archive_mgr.auto_label': 'Auto-Archive',
    'logs.archive_mgr.schedule': 'Schedule',
    'logs.archive_mgr.weekly': 'Weekly',
    'logs.archive_mgr.monthly': 'Monthly',
    'logs.archive_mgr.quarterly': 'Every 3 months',
    'logs.archive_mgr.biannual': 'Every 6 months',
    'logs.archive_mgr.annual': 'Annually',
    'logs.archive_mgr.upload': 'Upload',
    'logs.archive_mgr.delete': 'Delete',
    'logs.archive_mgr.run_now': 'Run Now',
    'logs.archive_mgr.status': 'Status',
    'logs.archive_mgr.enabled': 'Enabled',
    'logs.archive_mgr.disabled': 'Disabled',
    'logs.archive_mgr.next': 'Next',
    'logs.archive_mgr.due': 'Archive is due',
    'common.creating': 'Creating‚Ä¶',
    'common.create': 'Create',
    'common.uploading': 'Uploading‚Ä¶',
    'common.processing': 'Processing‚Ä¶',
    'common.running': 'Running‚Ä¶',
    'common.error': 'Error',
    'common.success': 'Success',
    'backup.title': 'Backup & Restore',
    'backup.subtitle': 'Manage local backups and Google Drive integration',
    'backup.tabs.local': 'Local Backup',
    'backup.tabs.drive': 'Google Drive',
    'backup.local.title': 'Local Backup',
    'backup.local.create': 'Create Backup',
    'backup.table.file': 'File Name',
    'backup.table.size': 'Size',
    'backup.table.modified': 'Modified',
    'backup.table.action': 'Action',
    'backup.none': 'No backup files found',
    'backup.none_hint': 'Create a backup to see files here',
    'backup.restoring': 'Restoring...',
    'backup.restore': 'Restore',
    'backup.create_ok': 'Backup created successfully',
    'backup.create_failed': 'Failed to create backup',
    'backup.confirm_restore': 'Are you sure you want to restore from this backup? This will overwrite current settings.',
    'backup.restore_ok': 'Backup restored successfully',
    'backup.restore_failed': 'Failed to restore backup',
    'backup.drive.title': 'Google Drive Integration',
    'backup.drive.subtitle': 'Backup and restore using Google Drive',
    // Analytics
    'analytics.title': 'üìä Analytics Dashboard',
    'analytics.realtime': 'Real-time',
    'analytics.tabs.tournament': 'Tournament',
    'analytics.tabs.athlete': 'Athlete',
    'analytics.tabs.match': 'Match',
    'analytics.tabs.day': 'Day',
    'analytics.select.tournament': 'Select Tournament',
    'analytics.select.athlete': 'Select Athlete',
    'analytics.select.match': 'Select Match',
    'analytics.select.date': 'Select Date',
    'analytics.placeholder.tournament': 'Choose a tournament',
    'analytics.placeholder.athlete': 'Choose an athlete',
    'analytics.placeholder.match': 'Choose a match',
    'analytics.placeholder.date': 'Choose a date',
    'analytics.all_tournaments': 'All Tournaments',
    'analytics.item.tournament': 'Tournament {id}',
    'analytics.item.match': 'Match {id}',
    'analytics.athlete.title': 'Athlete Analytics',
    'analytics.athlete.help': 'Select an athlete from the dropdown above to view their detailed analytics and performance metrics.',
    'analytics.match.title': 'Match Analytics',
    'analytics.match.help': 'Select a match from the dropdown above to view detailed match analytics and performance metrics.',
    'analytics.overview.title': 'üìà Analytics Overview',
    'analytics.metrics.total_events': 'Total Events',
    'analytics.metrics.unique_matches': 'Unique Matches',
    'analytics.metrics.unique_athletes': 'Unique Athletes',
    'analytics.metrics.tournaments': 'Tournaments',
    'analytics.badge': 'Analytics',
    'analytics.sections.overview': 'Overview',
    'analytics.sections.performance': 'Performance',
    'analytics.sections.matches': 'Matches',
    'analytics.sections.trends': 'Statistics',
    'analytics.athlete.total_matches': 'Total Matches',
    'analytics.athlete.win_rate': 'Win Rate',
    'analytics.athlete.total_points': 'Total Points',
    'analytics.athlete.avg_points': 'Avg Points/Match',
    'analytics.athlete.wins': 'Wins',
    'analytics.athlete.losses': 'Losses',
    'analytics.athlete.warnings': 'Warnings',
    'analytics.athlete.best_performance': 'Best Performance',
    'analytics.athlete.match_points': 'Match Points:',
    'analytics.athlete.match_id': 'Match ID:',
    'analytics.athlete.date': 'Date:',
    'analytics.athlete.no_performance': 'No performance data available',
    'analytics.athlete.total_points_scored': 'Total Points Scored',
    'analytics.athlete.total_warnings': 'Total Warnings',
    'analytics.athlete.recent_history': 'Recent Match History',
    'analytics.athlete.recent_summary': '{wins} wins, {losses} losses in {total} total matches',
    'analytics.athlete.no_history': 'No match history available',
    'analytics.athlete.performance_trends': 'Performance Trends',
    'analytics.athlete.win_rate_trend': 'Win Rate Trend:',
    'analytics.athlete.improving': '‚ÜóÔ∏è Improving',
    'analytics.athlete.declining': '‚ÜòÔ∏è Declining',
    'analytics.athlete.points_per_match': 'Points Per Match:',
    'analytics.athlete.discipline': 'Discipline:',
    'analytics.athlete.good': 'Good',
    'analytics.athlete.needs_improvement': 'Needs Improvement',
    // Match analytics
    'analytics.match.header': 'Match Analytics',
    'analytics.match.completed': 'Completed',
    'analytics.match.in_progress': 'In Progress',
    'analytics.match.winner': 'Winner: {name}',
    'analytics.match.tabs.athletes': 'Athletes',
    'analytics.match.tabs.events': 'Events',
    'analytics.match.duration': 'Duration',
    'analytics.match.intensity': 'Match Intensity',
    'analytics.match.events_per_min': 'events/min',
    'analytics.match.points_scored': 'Points Scored',
    'analytics.match.points': 'Points',
    'analytics.match.warnings': 'Warnings',
    'analytics.match.injuries': 'Injuries',
    'analytics.match.total_events': 'Total Events',
    'analytics.match.points_events': 'Points Events',
    'analytics.match.warning_events': 'Warning Events',
    'analytics.match.injury_events': 'Injury Events',
    'analytics.match.other_events': 'Other Events',
    'analytics.match.event_distribution': 'Event Distribution',
    'analytics.match.other': 'Other',
    'analytics.match.timeline': 'Match Timeline',
    'analytics.match.start_time': 'Start Time:',
    'analytics.match.end_time': 'End Time:',
    'analytics.match.events_per_minute': 'Events per Minute:',
    'analytics.match.status': 'Match Status',
    'analytics.match.status_label': 'Status:',
    'analytics.match.winner_label': 'Winner:',
    'analytics.match.id': 'Match ID:',
  },
  hr: {
    'drawer.pss': 'PSS',
    'drawer.obs': 'OBS',
    'drawer.ovr': 'OVR',
    'drawer.ivr': 'IVR',
    'drawer.ai': 'AI',
    'drawer.settings': 'Postavke',
    'app.title': 'reStrike VTA - Windows Desktop',
    'env.windows_native': 'Windows aplikacija',
    'env.web_mode': 'Web naƒçin',
    'status.ready': 'Status: Spremno',
    'settings.language': 'Jezik',
    'settings.select_language': 'Odaberite jezik',
    // Settings
    'settings.window.title': 'Postavke prozora',
    'settings.window.help': 'Konfigurirajte dimenzije prozora za kompaktni i cijeli zaslon.',
    'settings.window.compact': 'Kompaktni naƒçin (zadano)',
    'settings.window.full': 'Naƒçin preko cijelog zaslona (napredno)',
    'settings.window.width': '≈†irina (px)',
    'settings.window.height': 'Visina (px)',
    'settings.quick.title': 'Brze postavke',
    'settings.appearance.title': 'Izgled',
    'settings.appearance.theme': 'Tema',
    'settings.appearance.corners': 'Rubovi',
    'settings.appearance.dark': 'Tamna',
    'settings.appearance.light': 'Svijetla',
    'settings.appearance.square': 'Kvadratni',
    'settings.appearance.rounded': 'Zaobljeni',
    'settings.log.title': 'Razina zapisivanja',
    'settings.log.note': 'Ni≈æe razine smanjuju ≈°um u konzoli u produkciji.',
    'settings.actions.apply': 'Primijeni postavke',
    'settings.actions.reset': 'Resetiraj',
    'settings.note.title': 'Napomena:',
    'settings.note.text': 'Kompaktni naƒçin se koristi pri pokretanju aplikacije i kada je Napredni naƒçin iskljuƒçen. Naƒçin preko cijelog zaslona se koristi kada je Napredni naƒçin ukljuƒçen.',
    // Common
    'common.open': 'Otvori',
    'common.open_browser': 'Otvori u pregledniku',
    'common.copy': 'Kopiraj',
    'common.refresh': 'Osvje≈æi',
    'common.active': 'Aktivno',
    'common.connected': 'Povezano',
    'common.disconnected': 'Nepovezano',
    // Minimal analytics labels to confirm hr works; remaining keys fall back to en until filled
    'analytics.title': 'üìä Analitiƒçka nadzorna ploƒça',
    'analytics.realtime': 'U stvarnom vremenu',
    'analytics.tabs.tournament': 'Turnir',
    'analytics.tabs.athlete': 'Natjecatelj',
    'analytics.tabs.match': 'Meƒç',
    'analytics.tabs.day': 'Dan',
  },
  sr: {
    'logs.archive_mgr.title': 'Menad≈æer arhiviranja logova',
    'logs.archive_mgr.load_failed': 'Uƒçitavanje konfiguracije nije uspelo',
    'logs.archive_mgr.load_failed_with': 'Uƒçitavanje konfiguracije nije uspelo: {err}',
    'logs.archive_mgr.save_ok': 'Konfiguracija je uspe≈°no saƒçuvana',
    'logs.archive_mgr.save_failed': 'ƒåuvanje konfiguracije nije uspelo',
    'logs.archive_mgr.save_failed_with': 'ƒåuvanje konfiguracije nije uspelo: {err}',
    'logs.archive_mgr.create_ok': 'Arhiva je uspe≈°no kreirana: {name}',
    'logs.archive_mgr.create_failed': 'Nije uspelo kreiranje arhive',
    'logs.archive_mgr.create_failed_with': 'Nije uspelo kreiranje arhive: {err}',
    'logs.archive_mgr.upload_ok': 'Arhiva je uspe≈°no otpremljena',
    'logs.archive_mgr.upload_failed': 'Otprema arhive nije uspela',
    'logs.archive_mgr.upload_failed_with': 'Otprema arhive nije uspela: {err}',
    'logs.archive_mgr.upload_cleanup_ok': 'Arhiva je otpremljena i oƒçi≈°ƒáena',
    'logs.archive_mgr.upload_cleanup_failed': 'Otprema i ƒçi≈°ƒáenje arhive nije uspelo',
    'logs.archive_mgr.upload_cleanup_failed_with': 'Otprema i ƒçi≈°ƒáenje arhive nije uspelo: {err}',
    'logs.archive_mgr.auto_ok': 'Automatsko arhiviranje je zavr≈°eno',
    'logs.archive_mgr.auto_failed': 'Automatsko arhiviranje nije uspelo',
    'logs.archive_mgr.auto_failed_with': 'Automatsko arhiviranje nije uspelo: {err}',
    'logs.archive_mgr.create_title': 'Kreiraj lokalnu arhivu',
    'logs.archive_mgr.create_upload_title': 'Kreiraj i otpremi na Drive',
    'logs.archive_mgr.upload_delete_title': 'Otpremi i obri≈°i lokalnu kopiju',
    'logs.archive_mgr.auto_label': 'Automatsko arhiviranje',
    'logs.archive_mgr.schedule': 'Raspored',
    'logs.archive_mgr.weekly': 'Nedeljno',
    'logs.archive_mgr.monthly': 'Meseƒçno',
    'logs.archive_mgr.quarterly': 'Svakih 3 meseca',
    'logs.archive_mgr.biannual': 'Svakih 6 meseci',
    'logs.archive_mgr.annual': 'Godi≈°nje',
    'logs.archive_mgr.upload': 'Otpremi',
    'logs.archive_mgr.delete': 'Obri≈°i',
    'logs.archive_mgr.run_now': 'Pokreni sada',
    'logs.archive_mgr.status': 'Status',
    'logs.archive_mgr.enabled': 'Ukljuƒçeno',
    'logs.archive_mgr.disabled': 'Iskljuƒçeno',
    'logs.archive_mgr.next': 'Sledeƒáe',
    'logs.archive_mgr.due': 'Arhiviranje dospeva',
    'common.creating': 'Kreiranje‚Ä¶',
    'common.create': 'Kreiraj',
    'common.uploading': 'Otpremanje‚Ä¶',
    'common.processing': 'Obrada‚Ä¶',
    'common.running': 'Pokretanje‚Ä¶',
    'common.error': 'Gre≈°ka',
    'common.success': 'Uspeh',
    'backup.title': 'Bekap i obnova',
    'backup.subtitle': 'Upravljajte lokalnim bekapima i Google Drive integracijom',
    'backup.tabs.local': 'Lokalni bekap',
    'backup.tabs.drive': 'Google Drive',
    'backup.local.title': 'Lokalni bekap',
    'backup.local.create': 'Kreiraj bekap',
    'backup.table.file': 'Naziv fajla',
    'backup.table.size': 'Veliƒçina',
    'backup.table.modified': 'Izmenjeno',
    'backup.table.action': 'Akcija',
    'backup.none': 'Nema pronaƒëenih bekap fajlova',
    'backup.none_hint': 'Kreirajte bekap da bi se pojavio u listi',
    'backup.restoring': 'Vraƒáanje‚Ä¶',
    'backup.restore': 'Vrati',
    'backup.create_ok': 'Bekap je uspe≈°no kreiran',
    'backup.create_failed': 'Kreiranje bekapa nije uspelo',
    'backup.confirm_restore': 'Da li ste sigurni da ≈æelite da vratite ovaj bekap? Trenutna pode≈°avanja ƒáe biti prepisana.',
    'backup.restore_ok': 'Bekap je uspe≈°no vraƒáen',
    'backup.restore_failed': 'Vraƒáanje bekapa nije uspelo',
    'backup.drive.title': 'Google Drive integracija',
    'backup.drive.subtitle': 'Bekap i obnova uz Google Drive',
    'drawer.pss': 'PSS',
    'drawer.obs': 'OBS',
    'drawer.ovr': 'OVR',
    'drawer.ivr': 'IVR',
    'drawer.ai': 'AI',
    'drawer.settings': 'Pode≈°avanja',
    'app.title': 'reStrike VTA - Windows Desktop',
    'env.windows_native': 'Windows aplikacija',
    'env.web_mode': 'Veb re≈æim',
    'status.ready': 'Status: Spremno',
    'action.generic': 'Akcija',
    'common.retry': 'Poku≈°aj ponovo',
    'common.unknown_error': 'Nepoznata gre≈°ka',
    // Tabs
    'settings.tabs.diagnostics': 'Dijagnostika i menad≈æer logova',
    'settings.tabs.database': 'Baza podataka',
    'settings.tabs.backup': 'Bekap i obnova',
    'settings.tabs.app': 'Pode≈°avanja aplikacije',
    'ivr.tabs.history': 'Istorija meƒçeva',
    'ivr.tabs.settings': 'IVR video pode≈°avanja',
    'ovr.tabs.integration': 'Integracija',
    'ovr.tabs.tournament': 'Upravljanje turnirom',
    'obs.tabs.websocket': 'WebSocket',
    'obs.tabs.control_room': 'Kontrolna soba',
    'obs.tabs.integration': 'Integracija',
    'pss.tabs.udp': 'UDP server i protokol',
    'pss.tabs.flags': 'Upravljanje zastavama',
    'pss.tabs.scoreboard': 'Semafor',
    'pss.tabs.simulation': 'Simulacija',
    'pss.tabs.triggers': 'Okidaƒçi',
    // Settings content
    'settings.language': 'Jezik',
    'settings.select_language': 'Izaberite jezik',
    'settings.window.title': 'Pode≈°avanja prozora',
    'settings.window.help': 'Podesite dimenzije prozora za kompaktni i fullscreen re≈æim.',
    'settings.window.compact': 'Kompaktni re≈æim (podrazumevano)',
    'settings.window.full': 'Fullscreen re≈æim (napredno)',
    'settings.window.width': '≈†irina (px)',
    'settings.window.height': 'Visina (px)',
    'settings.quick.title': 'Brze postavke',
    'settings.appearance.title': 'Izgled',
    'settings.appearance.theme': 'Tema',
    'settings.appearance.corners': 'Uglovi',
    'settings.appearance.dark': 'Tamna',
    'settings.appearance.light': 'Svetla',
    'settings.appearance.square': 'Kvadratni',
    'settings.appearance.rounded': 'Zaobljeni',
    'settings.log.title': 'Nivo zapisivanja',
    'settings.log.note': 'Ni≈æi nivoi smanjuju ≈°um u konzoli u produkciji.',
    'settings.actions.apply': 'Primeni pode≈°avanja',
    'settings.actions.reset': 'Resetuj',
    'settings.note.title': 'Napomena:',
    'settings.note.text': 'Kompaktni re≈æim se koristi pri pokretanju aplikacije i kada je napredni re≈æim iskljuƒçen. Fullscreen re≈æim se koristi kada je napredni re≈æim ukljuƒçen.',
    // Logs (subset)
    'logs.title': 'Preuzimanje logova',
    'logs.type': 'Tip:',
    'logs.select_type': 'Izaberite tip loga',
    'logs.table.file': 'Naziv fajla',
    'logs.table.size': 'Veliƒçina',
    'logs.table.modified': 'Izmenjeno',
    'logs.loading': 'Uƒçitavanje logova...',
    'logs.downloading': 'Preuzimanje...',
    'logs.archive': 'Arhiva',
    'logs.double_click': 'Dupli klik za preuzimanje',
    'logs.none': 'Nema pronaƒëenih logova',
    'logs.none_error': 'Nema logova zbog gre≈°ke',
    'logs.error.fetch_archives': 'Neuspe≈°no preuzimanje arhiva',
    'logs.error.fetch_logs': 'Neuspe≈°no preuzimanje logova',
    'logs.error.timeout': 'Komanda je istekla. Backend je zauzet ili ne odgovara. Poku≈°ajte ponovo.',
    'logs.error.tauri_missing': 'Tauri nije dostupan. Pokrenite aplikaciju u desktop re≈æimu.',
    'logs.error.generic_fetch': 'Gre≈°ka pri preuzimanju {what}: {msg}',
    'logs.error.download_timeout': 'Isteklo vreme za preuzimanje {name}. Poku≈°ajte ponovo.',
    'logs.error.download_failed': 'Neuspe≈°no preuzimanje {name}: {msg}',
    'logs.error.tauri_no_download': 'Tauri nije dostupan. Nije moguƒáe preuzeti {name} u web re≈æimu.',
    'logs.error.download_error': 'Gre≈°ka pri preuzimanju {name}: {msg}',
    
    // OBS Integration prompts
    'obs.integration.no_connection': 'Nije odabrana veza',
    'obs.integration.save_ok': 'Konfiguracija je uspe≈°no spremljena!',
    'obs.integration.save_failed_with': 'Spremanje konfiguracije nije uspjelo: {err}',
    'obs.integration.select_first': 'Najprije odaberite vezu',
    'obs.integration.start_sent': 'Naredba za pokretanje snimanja je poslana.',
    'obs.integration.start_failed_with': 'Nije uspjelo pokretanje snimanja: {err}',
    'obs.integration.stop_sent': 'Naredba za zaustavljanje snimanja je poslana.',
    'obs.integration.stop_failed_with': 'Nije uspjelo zaustavljanje snimanja: {err}',
    'obs.integration.create_dirs_ok': '‚úÖ Mape su uspje≈°no kreirane!\n\nüìÅ Direktorij: {dir}\nüìÑ Naziv datoteke: {file}\nüìç Puna putanja: {full}',
    'obs.integration.create_dirs_failed': '‚ùå Kreiranje mapa nije uspjelo: {err}',
    'obs.integration.sent_ok': '‚úÖ Konfiguracija je poslana u OBS!\n\nüìÅ Put snimanja: {path}\nüìÑ Predlo≈æak naziva: {fmt}',
    'obs.integration.sent_failed': '‚ùå Slanje konfiguracije u OBS nije uspjelo: {err}',
    'obs.integration.db_path_ok': 'Put je generiran iz baze podataka',
    'obs.integration.db_path_failed': 'Generiranje puta iz baze nije uspjelo: {err}',
    'obs.integration.detect_videos_ok': 'Otkrivena mapa videa: {path}',
    'obs.integration.detect_videos_failed': 'Otkrivanje mape videa nije uspjelo: {err}',
    // Tournament management
    'tournament.title': 'Turniri',
    'tournament.add': 'Dodaj turnir',
    'tournament.loading': 'Uƒçitavanje turnira...',
    'tournament.none': 'Nema pronaƒëenih turnira. Kreirajte prvi turnir za poƒçetak.',
    'tournament.filters.all': 'Svi',
    'tournament.filters.pending': 'Na ƒçekanju',
    'tournament.filters.active': 'Aktivan',
    'tournament.filters.ended': 'Zavr≈°en',
    'tournament.overview': 'Pregled',
    'tournament.overview.title': 'Pregled turnira',
    'tournament.logo_alt': 'Logo turnira',
    'tournament.days.title': 'Dani turnira',
    'tournament.days.none': 'Nema pronaƒëenih dana turnira.',
    'tournament.day': 'Dan {n}',
    'tournament.started': 'Zapoƒçeto',
    'tournament.ended': 'Zavr≈°eno',
    'tournament.start': 'Pokreni turnir',
    'tournament.end': 'Zavr≈°i turnir',
    'tournament.start_day': 'Zapoƒçni dan',
    'tournament.end_day': 'Zavr≈°i dan',
    'tournament.start_day.title': 'Pokreni dan turnira',
    'tournament.end_day.title': 'Zavr≈°i dan turnira',
    'tournament.start_day.confirm': 'Jeste li sigurni da ≈æelite zapoƒçeti dan {n}? Ovo ƒáe automatski pokrenuti turnir ako je prvi dan.',
    'tournament.end_day.confirm': 'Jeste li sigurni da ≈æelite zavr≈°iti dan {n}? Ovo ƒáe automatski zavr≈°iti turnir ako je posljednji dan.',
    'tournament.starting': 'Pokretanje...',
    'tournament.ending': 'Zavr≈°avanje...',
    'tournament.stats.total_matches': 'Ukupno meƒçeva',
    'tournament.stats.total_events': 'Ukupno dogaƒëaja',
    'tournament.stats.total_scores': 'Ukupno bodova',
    'tournament.stats.total_warnings': 'Ukupno opomena',
    'tournament.days.progress': 'Napredak dana turnira',
    'tournament.days.pending': 'Dani na ƒçekanju',
    'tournament.days.active': 'Aktivni dan',
    'tournament.days.completed': 'Zavr≈°eni dani',
    'tournament.timeline': 'Vremenska crta turnira',
    'tournament.created': 'Kreirano',
    'tournament.add_new': 'Dodaj novi turnir',
    'tournament.create': 'Kreiraj turnir',
    'tournament.edit': 'Uredi turnir',
    'tournament.update': 'A≈æuriraj turnir',
    'tournament.form.name': 'Naziv turnira',
    'tournament.form.name_ph': 'Unesite naziv turnira',
    'tournament.form.duration': 'Trajanje (dana)',
    'tournament.form.city': 'Grad',
    'tournament.form.city_ph': 'Unesite grad',
    'tournament.form.country': 'Dr≈æava',
    'tournament.form.country_ph': 'Unesite dr≈æavu',
    'tournament.form.start_date': 'Datum poƒçetka (opcionalno)',
    'tournament.form.logo': 'Logo turnira (opcionalno)',
    'tournament.location.verify': 'Provjeri lokaciju',
    'tournament.location.verifying': 'Provjera...',
    'tournament.location.verified': 'Provjereno',
    'tournament.location.enter_city_country': 'Unesite i grad i dr≈æavu',
    'tournament.location.not_found': 'Lokacija nije pronaƒëena ili mre≈æa nije dostupna. Mo≈æete nastaviti ruƒçni unos.',
    'tournament.location.failed': 'Provjera lokacije nije uspjela',
    'tournament.location.network_error': 'Mre≈æna gre≈°ka. Mo≈æete nastaviti ruƒçni unos.',
    'tournament.confirm_delete': 'Jeste li sigurni da ≈æelite obrisati ovaj turnir? Ova radnja je nepovratna.',
    'tournament.error.load': 'Neuspjelo uƒçitavanje turnira',
    'tournament.error.loading_with': 'Gre≈°ka pri uƒçitavanju turnira: {err}',
    'tournament.error.load_one': 'Neuspjelo uƒçitavanje turnira',
    'tournament.error.load_days': 'Neuspjelo uƒçitavanje dana turnira',
    'tournament.error.load_stats': 'Neuspjelo uƒçitavanje statistike turnira',
    'tournament.error.loading_overview_with': 'Gre≈°ka pri uƒçitavanju pregleda turnira: {err}',
    'tournament.error.start_day': 'Neuspjelo pokretanje dana turnira',
    'tournament.error.start_day_with': 'Gre≈°ka pri pokretanju dana turnira: {err}',
    'tournament.error.end_day': 'Neuspjelo zavr≈°avanje dana turnira',
    'tournament.error.end_day_with': 'Gre≈°ka pri zavr≈°avanju dana turnira: {err}',
    // Analytics (Croatian)
    'analytics.title': 'üìä Analitiƒçka nadzorna ploƒça',
    'analytics.realtime': 'U stvarnom vremenu',
    'analytics.tabs.tournament': 'Turnir',
    'analytics.tabs.athlete': 'Natjecatelj',
    'analytics.tabs.match': 'Meƒç',
    'analytics.tabs.day': 'Dan',
    'analytics.select.tournament': 'Odaberite turnir',
    'analytics.select.athlete': 'Odaberite natjecatelja',
    'analytics.select.match': 'Odaberite meƒç',
    'analytics.select.date': 'Odaberite datum',
    'analytics.placeholder.tournament': 'Odaberite turnir',
    'analytics.placeholder.athlete': 'Odaberite natjecatelja',
    'analytics.placeholder.match': 'Odaberite meƒç',
    'analytics.placeholder.date': 'Odaberite datum',
    'analytics.all_tournaments': 'Svi turniri',
    'analytics.item.tournament': 'Turnir {id}',
    'analytics.item.match': 'Meƒç {id}',
    'analytics.athlete.title': 'Analitika natjecatelja',
    'analytics.athlete.help': 'Odaberite natjecatelja iz gornjeg izbornika za detaljne analitike i metrike.',
    'analytics.match.title': 'Analitika meƒça',
    'analytics.match.help': 'Odaberite meƒç iz gornjeg izbornika za detaljne analitike meƒça i metrike.',
    'analytics.overview.title': 'üìà Sa≈æetak analitike',
    'analytics.metrics.total_events': 'Ukupno dogaƒëaja',
    'analytics.metrics.unique_matches': 'Jedinstveni meƒçevi',
    'analytics.metrics.unique_athletes': 'Jedinstveni natjecatelji',
    'analytics.metrics.tournaments': 'Turniri',
    // Common additions used here
    'common.pending': 'Na ƒçekanju',
    'common.active': 'Aktivan',
    'common.ended': 'Zavr≈°en',
    'common.edit': 'Uredi',
    'common.delete': 'Obri≈°i',
    'common.close': 'Zatvori',
    'common.cancel': 'Otka≈æi',
    'common.loading': 'Uƒçitavanje...',
    'common.updating': 'A≈æuriranje...',
    'analytics.badge': 'Analitika',
    'analytics.sections.overview': 'Pregled',
    'analytics.sections.performance': 'Uƒçinak',
    'analytics.sections.matches': 'Meƒçevi',
    'analytics.sections.trends': 'Statistika',
    'analytics.athlete.total_matches': 'Ukupno meƒçeva',
    'analytics.athlete.win_rate': 'Postotak pobjeda',
    'analytics.athlete.total_points': 'Ukupno bodova',
    'analytics.athlete.avg_points': 'Prosjeƒçno bodova/meƒç',
    'analytics.athlete.wins': 'Pobjede',
    'analytics.athlete.losses': 'Porazi',
    'analytics.athlete.warnings': 'Opomene',
    'analytics.athlete.best_performance': 'Najbolji uƒçinak',
    'analytics.athlete.match_points': 'Bodovi u meƒçu:',
    'analytics.athlete.match_id': 'ID meƒça:',
    'analytics.athlete.date': 'Datum:',
    'analytics.athlete.no_performance': 'Nema dostupnih podataka o uƒçinku',
    'analytics.athlete.total_points_scored': 'Ukupno osvojenih bodova',
    'analytics.athlete.total_warnings': 'Ukupno opomena',
    'analytics.athlete.recent_history': 'Nedavna povijest meƒçeva',
    'analytics.athlete.recent_summary': '{wins} pobjeda, {losses} poraza u {total} meƒçeva',
    'analytics.athlete.no_history': 'Nema povijesti meƒçeva',
    'analytics.athlete.performance_trends': 'Trendovi uƒçinka',
    'analytics.athlete.win_rate_trend': 'Trend pobjeda:',
    'analytics.athlete.improving': '‚ÜóÔ∏è Napredak',
    'analytics.athlete.declining': '‚ÜòÔ∏è Pad',
    'analytics.athlete.points_per_match': 'Bodova po meƒçu:',
    'analytics.athlete.discipline': 'Disciplina:',
    'analytics.athlete.good': 'Dobro',
    'analytics.athlete.needs_improvement': 'Potrebno pobolj≈°anje',
    // Match analytics (Croatian)
    'analytics.match.header': 'Analitika meƒça',
    'analytics.match.completed': 'Zavr≈°en',
    'analytics.match.in_progress': 'U tijeku',
    'analytics.match.winner': 'Pobjednik: {name}',
    'analytics.match.tabs.athletes': 'Natjecatelji',
    'analytics.match.tabs.events': 'Dogaƒëaji',
    'analytics.match.duration': 'Trajanje',
    'analytics.match.intensity': 'Intenzitet meƒça',
    'analytics.match.events_per_min': 'dogaƒëaja/min',
    'analytics.match.points_scored': 'Osvojeni bodovi',
    'analytics.match.points': 'Bodovi',
    'analytics.match.warnings': 'Opomene',
    'analytics.match.injuries': 'Ozljede',
    'analytics.match.total_events': 'Ukupno dogaƒëaja',
    'analytics.match.points_events': 'Bodovni dogaƒëaji',
    'analytics.match.warning_events': 'Upozorenja',
    'analytics.match.injury_events': 'Dogaƒëaji ozljeda',
    'analytics.match.other_events': 'Ostali dogaƒëaji',
    'analytics.match.event_distribution': 'Distribucija dogaƒëaja',
    'analytics.match.other': 'Ostalo',
    'analytics.match.timeline': 'Vremenska crta meƒça',
    'analytics.match.start_time': 'Vrijeme poƒçetka:',
    'analytics.match.end_time': 'Vrijeme zavr≈°etka:',
    'analytics.match.events_per_minute': 'Dogaƒëaja u minuti:',
    'analytics.match.status': 'Status meƒça',
    'analytics.match.status_label': 'Status:',
    'analytics.match.winner_label': 'Pobjednik:',
    'analytics.match.id': 'ID meƒça:',
  },
  de: {
    'drawer.pss': 'PSS',
    'drawer.obs': 'OBS',
    'drawer.ovr': 'OVR',
    'drawer.ivr': 'IVR',
    'drawer.ai': 'AI',
    'drawer.settings': 'Einstellungen',
    'app.title': 'reStrike VTA - Windows Desktop',
    'env.windows_native': 'Windows-Anwendung',
    'env.web_mode': 'Web-Modus',
    'status.ready': 'Status: Bereit',
    'action.generic': 'Aktion',
    'settings.tabs.diagnostics': 'Diagnostik & Protokollverwaltung',
    'settings.tabs.database': 'Datenbank',
    'settings.tabs.backup': 'Sicherung & Wiederherstellung',
    'settings.tabs.app': 'App-Einstellungen',
    'ivr.tabs.history': 'Match-Verlauf',
    'ivr.tabs.settings': 'IVR Videoeinstellungen',
    'ovr.tabs.integration': 'Integration',
    'ovr.tabs.tournament': 'Turnierverwaltung',
    'obs.tabs.websocket': 'WebSocket',
    'obs.tabs.control_room': 'Kontrollraum',
    'obs.tabs.integration': 'Integration',
    'pss.tabs.udp': 'UDP-Server & Protokoll',
    'pss.tabs.flags': 'Flaggenverwaltung',
    'pss.tabs.scoreboard': "Anzeigetafel",
    'pss.tabs.simulation': 'Simulation',
    'pss.tabs.triggers': 'Ausl√∂ser',
    'settings.language': 'Sprache',
    'settings.select_language': 'Sprache ausw√§hlen',
    // Backup/Archive common
    'common.creating': 'Wird erstellt‚Ä¶',
    'common.create': 'Erstellen',
    'common.uploading': 'Wird hochgeladen‚Ä¶',
    'common.processing': 'Wird verarbeitet‚Ä¶',
    'common.running': 'Wird ausgef√ºhrt‚Ä¶',
    'common.error': 'Fehler',
    'common.success': 'Erfolg',
    // Logs for LogDownloadList
    'logs.title': 'Protokolle herunterladen',
    'logs.type': 'Typ:',
    'logs.select_type': 'Protokolltyp ausw√§hlen',
    'logs.types.pss': 'PSS',
    'logs.types.obs': 'OBS',
    'logs.types.udp': 'UDP',
    'logs.types.websocket': 'WebSocket',
    'logs.types.db': 'Datenbank',
    'logs.types.app': 'Anwendung',
    'logs.types.arc': 'Archiv',
    'logs.table.file': 'Dateiname',
    'logs.table.size': 'Gr√∂√üe',
    'logs.table.modified': 'Ge√§ndert',
    'logs.loading': 'Protokolle werden geladen...',
    'logs.downloading': 'Wird heruntergeladen...',
    'logs.archive': 'Archiv',
    'logs.double_click': 'Doppelklicken zum Herunterladen',
    'logs.none': 'Keine Protokolle gefunden',
    'logs.none_error': 'Keine Protokolle aufgrund eines Fehlers',
    'logs.error.fetch_archives': 'Archivdateien konnten nicht abgerufen werden',
    'logs.error.fetch_logs': 'Protokolldateien konnten nicht abgerufen werden',
    'logs.error.timeout': 'Zeit√ºberschreitung. Dienst ist besch√§ftigt oder reagiert nicht. Bitte erneut versuchen.',
    'logs.error.tauri_missing': 'Tauri nicht verf√ºgbar. Bitte im Desktop-Modus ausf√ºhren.',
    'logs.error.generic_fetch': 'Fehler beim Abrufen von {what}: {msg}',
    'logs.error.download_timeout': 'Zeit√ºberschreitung beim Herunterladen von {name}. Bitte erneut versuchen.',
    'logs.error.download_failed': 'Herunterladen von {name} fehlgeschlagen: {msg}',
    'logs.error.tauri_no_download': '{name} kann im Webmodus nicht heruntergeladen werden.',
    'logs.error.download_error': 'Fehler beim Herunterladen von {name}: {msg}',
    // Backup & Restore
    'backup.title': 'Sicherung & Wiederherstellung',
    'backup.subtitle': 'Lokale Sicherungen und Google Drive Integration verwalten',
    'backup.tabs.local': 'Lokale Sicherung',
    'backup.tabs.drive': 'Google Drive',
    'backup.local.title': 'Lokale Sicherung',
    'backup.local.create': 'Sicherung erstellen',
    'backup.table.file': 'Dateiname',
    'backup.table.size': 'Gr√∂√üe',
    'backup.table.modified': 'Ge√§ndert',
    'backup.table.action': 'Aktion',
    'backup.none': 'Keine Sicherungsdateien gefunden',
    'backup.none_hint': 'Erstellen Sie eine Sicherung, um sie hier zu sehen',
    'backup.restoring': 'Wiederherstellung‚Ä¶',
    'backup.restore': 'Wiederherstellen',
    'backup.create_ok': 'Sicherung erfolgreich erstellt',
    'backup.create_failed': 'Erstellen der Sicherung fehlgeschlagen',
    'backup.confirm_restore': 'Sind Sie sicher, dass Sie diese Sicherung wiederherstellen m√∂chten? Aktuelle Einstellungen werden √ºberschrieben.',
    'backup.restore_ok': 'Sicherung erfolgreich wiederhergestellt',
    'backup.restore_failed': 'Wiederherstellung fehlgeschlagen',
    'backup.drive.title': 'Google Drive Integration',
    'backup.drive.subtitle': 'Sichern und Wiederherstellen mit Google Drive',
    // Archive Manager
    'logs.archive_mgr.title': 'Log-Archiv-Manager',
    'logs.archive_mgr.load_failed': 'Konfiguration konnte nicht geladen werden',
    'logs.archive_mgr.load_failed_with': 'Konfiguration konnte nicht geladen werden: {err}',
    'logs.archive_mgr.save_ok': 'Konfiguration erfolgreich gespeichert',
    'logs.archive_mgr.save_failed': 'Konfiguration konnte nicht gespeichert werden',
    'logs.archive_mgr.save_failed_with': 'Konfiguration konnte nicht gespeichert werden: {err}',
    'logs.archive_mgr.create_ok': 'Archiv erfolgreich erstellt: {name}',
    'logs.archive_mgr.create_failed': 'Archiv konnte nicht erstellt werden',
    'logs.archive_mgr.create_failed_with': 'Archiv konnte nicht erstellt werden: {err}',
    'logs.archive_mgr.upload_ok': 'Archiv erfolgreich hochgeladen',
    'logs.archive_mgr.upload_failed': 'Hochladen des Archivs fehlgeschlagen',
    'logs.archive_mgr.upload_failed_with': 'Hochladen des Archivs fehlgeschlagen: {err}',
    'logs.archive_mgr.upload_cleanup_ok': 'Archiv hochgeladen und bereinigt',
    'logs.archive_mgr.upload_cleanup_failed': 'Hochladen und Bereinigen fehlgeschlagen',
    'logs.archive_mgr.upload_cleanup_failed_with': 'Hochladen und Bereinigen fehlgeschlagen: {err}',
    'logs.archive_mgr.auto_ok': 'Automatische Archivierung abgeschlossen',
    'logs.archive_mgr.auto_failed': 'Automatische Archivierung fehlgeschlagen',
    'logs.archive_mgr.auto_failed_with': 'Automatische Archivierung fehlgeschlagen: {err}',
    'logs.archive_mgr.create_title': 'Lokales Archiv erstellen',
    'logs.archive_mgr.create_upload_title': 'Erstellen und auf Drive hochladen',
    'logs.archive_mgr.upload_delete_title': 'Hochladen und lokale Kopie l√∂schen',
    'logs.archive_mgr.auto_label': 'Automatische Archivierung',
    'logs.archive_mgr.schedule': 'Zeitplan',
    'logs.archive_mgr.weekly': 'W√∂chentlich',
    'logs.archive_mgr.monthly': 'Monatlich',
    'logs.archive_mgr.quarterly': 'Alle 3 Monate',
    'logs.archive_mgr.biannual': 'Alle 6 Monate',
    'logs.archive_mgr.annual': 'Annuel',
    'logs.archive_mgr.upload': 'Hochladen',
    'logs.archive_mgr.delete': 'L√∂schen',
    'logs.archive_mgr.run_now': 'Jetzt ausf√ºhren',
    'logs.archive_mgr.status': 'Statut',
    'logs.archive_mgr.enabled': 'Aktiviert',
    'logs.archive_mgr.disabled': 'Deaktiviert',
    'logs.archive_mgr.next': 'N√§chste',
    'logs.archive_mgr.due': 'Archivierung f√§llig',
    // OBS Integration prompts
    'obs.integration.no_connection': 'Keine Verbindung ausgew√§hlt',
    'obs.integration.save_ok': 'Konfiguration erfolgreich gespeichert!',
    'obs.integration.save_failed_with': 'Konfiguration konnte nicht gespeichert werden: {err}',
    'obs.integration.select_first': 'Bitte zuerst eine Verbindung ausw√§hlen',
    'obs.integration.start_sent': 'Commande de d√©marrage de l\'enregistrement envoy√©e.',
    'obs.integration.start_failed_with': '√âchec du d√©marrage de l\'enregistrement : {err}',
    'obs.integration.stop_sent': 'Commande d\'arr√™t de l\'enregistrement envoy√©e.',
    'obs.integration.stop_failed_with': '√âchec de l\'arr√™t de l\'enregistrement : {err}',
    'obs.integration.create_dirs_ok': '‚úÖ Dossiers cr√©√©s avec succ√®s !\n\nüìÅ R√©pertoire : {dir}\nüìÑ Nom de fichier : {file}\nüìç Chemin complet : {full}',
    'obs.integration.create_dirs_failed': '‚ùå √âchec de la cr√©ation des dossiers : {err}',
    'obs.integration.sent_ok': '‚úÖ Configuration envoy√©e √† OBS !\n\nüìÅ Chemin d\'enregistrement : {path}\nüìÑ Mod√®le de nom : {fmt}',
    'obs.integration.sent_failed': '‚ùå √âchec de l\'envoi √† OBS : {err}',
    'obs.integration.db_path_ok': 'Chemin g√©n√©r√© depuis la base de donn√©es',
    'obs.integration.db_path_failed': '√âchec de la g√©n√©ration du chemin : {err}',
    'obs.integration.detect_videos_ok': 'Dossier Vid√©os d√©tect√© : {path}',
    'obs.integration.detect_videos_failed': '√âchec de la d√©tection du dossier Vid√©os : {err}',
  },
  fr: {
    'drawer.pss': 'PSS',
    'drawer.obs': 'OBS',
    'drawer.ovr': 'OVR',
    'drawer.ivr': 'IVR',
    'drawer.ai': 'AI',
    'drawer.settings': 'Param√®tres',
    'app.title': 'reStrike VTA - Windows Desktop',
    'env.windows_native': 'Application Windows',
    'env.web_mode': 'Mode Web',
    'status.ready': 'Statut : Pr√™t',
    'action.generic': 'Action',
    'settings.tabs.diagnostics': 'Diagnostic et gestion des journaux',
    'settings.tabs.database': 'Base de donn√©es',
    'settings.tabs.backup': 'Sauvegarde et restauration',
    'settings.tabs.app': "Param√®tres de l'application",
    'ivr.tabs.history': 'Historique des matchs',
    'ivr.tabs.settings': 'Param√®tres vid√©o IVR',
    'ovr.tabs.integration': 'Int√©gration',
    'ovr.tabs.tournament': 'Gestion du tournoi',
    'obs.tabs.websocket': 'WebSocket',
    'obs.tabs.control_room': 'Salle de contr√¥le',
    'obs.tabs.integration': 'Int√©gration',
    'pss.tabs.udp': 'Serveur UDP et protocole',
    'pss.tabs.flags': 'Gestion des drapeaux',
    'pss.tabs.scoreboard': "Tableau d'affichage",
    'pss.tabs.simulation': 'Simulation',
    'pss.tabs.triggers': 'D√©clencheurs',
    'settings.language': 'Langue',
    'settings.select_language': 'S√©lectionnez la langue',
    // Backup/Archive common
    'common.creating': 'Cr√©ation‚Ä¶',
    'common.create': 'Cr√©er',
    'common.uploading': 'T√©l√©versement‚Ä¶',
    'common.processing': 'Traitement‚Ä¶',
    'common.running': 'Ex√©cution‚Ä¶',
    'common.error': 'Erreur',
    'common.success': 'Succ√®s',
    // Logs for LogDownloadList
    'logs.title': 'T√©l√©charger les journaux',
    'logs.type': 'Type :',
    'logs.select_type': 'S√©lectionnez le type de journal',
    'logs.types.pss': 'PSS',
    'logs.types.obs': 'OBS',
    'logs.types.udp': 'UDP',
    'logs.types.websocket': 'WebSocket',
    'logs.types.db': 'Base de donn√©es',
    'logs.types.app': 'Application',
    'logs.types.arc': 'Archive',
    'logs.table.file': 'Nom du fichier',
    'logs.table.size': 'Taille',
    'logs.table.modified': 'Modifi√©',
    'logs.loading': 'Chargement des journaux...',
    'logs.downloading': 'T√©l√©chargement...',
    'logs.archive': 'Archive',
    'logs.double_click': 'Double-cliquez pour t√©l√©charger',
    'logs.none': 'Aucun journal trouv√©',
    'logs.none_error': "Aucun journal en raison d'une erreur",
    'logs.error.fetch_archives': '√âchec du chargement des archives',
    'logs.error.fetch_logs': '√âchec du chargement des journaux',
    'logs.error.timeout': 'La commande a expir√©. Le service est occup√© ou ne r√©pond pas. Veuillez r√©essayer.',
    'logs.error.tauri_missing': "Tauri non disponible. Assurez-vous que l'application est en mode bureau.",
    'logs.error.generic_fetch': 'Erreur lors du chargement de {what} : {msg}',
    'logs.error.download_timeout': 'D√©lai d√©pass√© pour le t√©l√©chargement de {name}. Veuillez r√©essayer.',
    'logs.error.download_failed': '√âchec du t√©l√©chargement de {name} : {msg}',
    'logs.error.tauri_no_download': 'Impossible de t√©l√©charger {name} en mode web.',
    'logs.error.download_error': 'Erreur lors du t√©l√©chargement de {name} : {msg}',
    // Backup & Restore
    'backup.title': 'Sauvegarde et restauration',
    'backup.subtitle': 'G√©rez les sauvegardes locales et l\'int√©gration Google Drive',
    'backup.tabs.local': 'Sauvegarde locale',
    'backup.tabs.drive': 'Google Drive',
    'backup.local.title': 'Sauvegarde locale',
    'backup.local.create': 'Cr√©er une sauvegarde',
    'backup.table.file': 'Nom du fichier',
    'backup.table.size': 'Taille',
    'backup.table.modified': 'Modifi√©',
    'backup.table.action': 'Action',
    'backup.none': 'Aucune sauvegarde trouv√©e',
    'backup.none_hint': 'Cr√©ez une sauvegarde pour la voir ici',
    'backup.restoring': 'Restauration...',
    'backup.restore': 'Restaurer',
    'backup.create_ok': 'Sauvegarde cr√©√©e avec succ√®s',
    'backup.create_failed': '√âchec de la cr√©ation de la sauvegarde',
    'backup.confirm_restore': '√ätes-vous s√ªr de vouloir restaurer cette sauvegarde ? Les param√®tres actuels seront remplac√©s.',
    'backup.restore_ok': 'Sauvegarde restaur√©e avec succ√®s',
    'backup.restore_failed': '√âchec de la restauration',
    'backup.drive.title': 'Int√©gration Google Drive',
    'backup.drive.subtitle': 'Sauvegarder et restaurer avec Google Drive',
    // Archive Manager
    'logs.archive_mgr.title': 'Gestionnaire d\'archives des journaux',
    'logs.archive_mgr.load_failed': '√âchec du chargement de la configuration',
    'logs.archive_mgr.load_failed_with': '√âchec du chargement : {err}',
    'logs.archive_mgr.save_ok': 'Configuration enregistr√©e avec succ√®s',
    'logs.archive_mgr.save_failed': '√âchec de l\'enregistrement de la configuration',
    'logs.archive_mgr.save_failed_with': '√âchec de l\'enregistrement : {err}',
    'logs.archive_mgr.create_ok': 'Archive cr√©√©e avec succ√®s : {name}',
    'logs.archive_mgr.create_failed': '√âchec de la cr√©ation de l\'archive',
    'logs.archive_mgr.create_failed_with': '√âchec de la cr√©ation : {err}',
    'logs.archive_mgr.upload_ok': 'Archive t√©l√©vers√©e avec succ√®s',
    'logs.archive_mgr.upload_failed': '√âchec du t√©l√©versement de l\'archive',
    'logs.archive_mgr.upload_failed_with': '√âchec du t√©l√©versement : {err}',
    'logs.archive_mgr.upload_cleanup_ok': 'Archive t√©l√©vers√©e et nettoy√©e',
    'logs.archive_mgr.upload_cleanup_failed': '√âchec du t√©l√©versement/nettoyage',
    'logs.archive_mgr.upload_cleanup_failed_with': '√âchec du t√©l√©versement/nettoyage : {err}',
    'logs.archive_mgr.auto_ok': 'Archivage automatique termin√©',
    'logs.archive_mgr.auto_failed': 'Archivage automatique √©chou√©',
    'logs.archive_mgr.auto_failed_with': 'Archivage automatique √©chou√© : {err}',
    'logs.archive_mgr.create_title': 'Cr√©er une archive locale',
    'logs.archive_mgr.create_upload_title': 'Cr√©er et t√©l√©verser sur Drive',
    'logs.archive_mgr.upload_delete_title': 'T√©l√©verser et supprimer la copie locale',
    'logs.archive_mgr.auto_label': 'Archivage automatique',
    'logs.archive_mgr.schedule': 'Planification',
    'logs.archive_mgr.weekly': 'Hebdomadaire',
    'logs.archive_mgr.monthly': 'Mensuel',
    'logs.archive_mgr.quarterly': 'Tous les 3 mois',
    'logs.archive_mgr.biannual': 'Tous les 6 mois',
    'logs.archive_mgr.annual': 'Annuel',
    'logs.archive_mgr.upload': 'T√©l√©verser',
    'logs.archive_mgr.delete': 'Supprimer',
    'logs.archive_mgr.run_now': 'Ex√©cuter maintenant',
    'logs.archive_mgr.status': 'Statut',
    'logs.archive_mgr.enabled': 'Activ√©',
    'logs.archive_mgr.disabled': 'D√©sactiv√©',
    'logs.archive_mgr.next': 'Suivant',
    'logs.archive_mgr.due': 'Archivage √† faire',
    // OBS Integration prompts
    'obs.integration.no_connection': 'Aucune connexion s√©lectionn√©e',
    'obs.integration.save_ok': 'Configuration enregistr√©e avec succ√®s !',
    'obs.integration.save_failed_with': '√âchec de l\'enregistrement de la configuration : {err}',
    'obs.integration.select_first': 'Veuillez d\'abord s√©lectionner une connexion',
    'obs.integration.start_sent': 'Commande de d√©marrage de l\'enregistrement envoy√©e.',
    'obs.integration.start_failed_with': '√âchec du d√©marrage de l\'enregistrement : {err}',
    'obs.integration.stop_sent': 'Commande d\'arr√™t de l\'enregistrement envoy√©e.',
    'obs.integration.stop_failed_with': '√âchec de l\'arr√™t de l\'enregistrement : {err}',
    'obs.integration.create_dirs_ok': '‚úÖ Dossiers cr√©√©s avec succ√®s !\n\nüìÅ R√©pertoire : {dir}\nüìÑ Nom de fichier : {file}\nüìç Chemin complet : {full}',
    'obs.integration.create_dirs_failed': '‚ùå √âchec de la cr√©ation des dossiers : {err}',
    'obs.integration.sent_ok': '‚úÖ Configuration envoy√©e √† OBS !\n\nüìÅ Chemin d\'enregistrement : {path}\nüìÑ Mod√®le de nom : {fmt}',
    'obs.integration.sent_failed': '‚ùå √âchec de l\'envoi √† OBS : {err}',
    'obs.integration.db_path_ok': 'Chemin g√©n√©r√© depuis la base de donn√©es',
    'obs.integration.db_path_failed': '√âchec de la g√©n√©ration du chemin : {err}',
    'obs.integration.detect_videos_ok': 'Dossier Vid√©os d√©tect√© : {path}',
    'obs.integration.detect_videos_failed': '√âchec de la d√©tection du dossier Vid√©os : {err}',
  },
};

function normalizeLocale(input: string | undefined | null): string {
  if (!input || typeof input !== 'string') return 'en';
  try {
    const short = input.toLowerCase().split('-')[0];
    const exists = Boolean((catalogs as any)[short]);
    console.log('[i18n] normalizeLocale:', { input, short, exists });
    return exists ? short : 'en';
  } catch {
    console.warn('[i18n] normalizeLocale failed, defaulting to en for input:', input);
    return 'en';
  }
}

function interpolate(str: string, values?: Record<string, string | number>): string {
  if (!str || !values) return str;
  return str.replace(/\{(.*?)\}/g, (_m, key) => {
    const v = values[key.trim()];
    return v === undefined || v === null ? '' : String(v);
  });
}

export const I18nProvider: React.FC<React.PropsWithChildren<{ defaultLocale?: string }>> = ({ children, defaultLocale }) => {
  const initialLocale = useMemo(() => {
    try {
      const stored = localStorage.getItem(I18N_STORAGE_KEY);
      if (stored) {
        const norm = normalizeLocale(stored);
        console.log('[i18n] initial from localStorage:', { stored, norm });
        return norm;
      }
      if (defaultLocale) {
        const norm = normalizeLocale(defaultLocale);
        console.log('[i18n] initial from defaultLocale prop:', { defaultLocale, norm });
        return norm;
      }
      if (typeof navigator !== 'undefined' && navigator.language) {
        const short = normalizeLocale(navigator.language);
        const exists = Boolean((catalogs as any)[short]);
        console.log('[i18n] initial from navigator:', { navigatorLanguage: navigator.language, short, exists });
        if (exists) return short;
      }
    } catch {}
    return 'en';
  }, [defaultLocale]);

  const [locale, setLocaleState] = useState<string>(initialLocale);

  useEffect(() => {
    try {
      localStorage.setItem(I18N_STORAGE_KEY, locale);
      console.log('[i18n] persisted locale to storage:', locale);
    } catch (e) {
      console.warn('[i18n] failed to persist locale:', e);
    }
  }, [locale]);

  const t = useMemo(() => {
    return (id: string, fallback?: string, values?: Record<string, string | number>) => {
      const primary = catalogs[locale] || {};
      let raw: string | undefined = primary[id];
      if (raw === undefined) {
        raw = fallback ?? id;
        if (primary[id] === undefined && fallback === undefined) {
          console.debug('[i18n] missing key; using id as string', { locale, id });
        }
      }
      return interpolate(raw, values);
    };
  }, [locale]);

  const setLocale = (loc: string) => {
    const normalized = normalizeLocale(loc);
    setLocaleState(normalized);
    try { localStorage.setItem(I18N_STORAGE_KEY, normalized); } catch {}
    console.log('[i18n] setLocale called:', { requested: loc, normalized });
  };

  const value: I18nContextValue = { locale, setLocale, t };
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export function useI18n(): I18nContextValue {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
}

interface TProps { id: string; default?: string; values?: Record<string, string | number>; className?: string }
export const T: React.FC<TProps> = ({ id, default: fb, values, className }) => {
  const { t } = useI18n();
  return <span className={className}>{t(id, fb, values)}</span>;
};
